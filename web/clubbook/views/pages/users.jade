extends ../layout

block content
  //
     BEGIN PAGE HEADER
  h3.page-title
    | Users
  .page-bar
    ul.page-breadcrumb
      li
        i.fa.fa-home
        a(href='/users') Users
  //
     END PAGE HEADER
  //
     BEGIN PAGE CONTENT
  .row
    .col-md-12
      table#users.table.table-striped.table-bordered.table-hover
        thead
          tr
            th
              | Avatar
            th
              | Name
            th
              | Email
            th
              | Gender
            th
              | Date of Installation
            th
        tbody

  //
     END PAGE CONTENT
//
 END CONTENT

block scripts
  script(src='/assets/global/plugins/jquery.sparkline.min.js', type='text/javascript')
  script(src='/assets/global/plugins/gritter/js/jquery.gritter.js', type='text/javascript')
  script(src="/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js", type="text/javascript")
  script(src="/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js",type="text/javascript")


  script(type="text/javascript")
    $(function () {

    $('#users').dataTable({
          "scrollX": false,
          "aoColumns": [
                    null,
                    null,
                    null,
                    null,
                    null,
                    null
                  ],

          "aLengthMenu": [
              [10, 25, 50, 100],
              [10, 25, 50, 100]
          ],
          "bFilter": false,

          "iDisplayLength": 25,
          "bProcessing": true,
          "bServerSide": true,
          "sAjaxSource": "/_a/user/list"
      });

    $(document).on("click", '.user_replay', function() {
      $(this).next("[name=user_replay_form]").show();
      return $(this).hide();
    });

    $(document).on("click", '.user_send_cancel', function() {
      $(this).parent().parent().find(".user_replay").show();
      return $(this).closest("[name=user_replay_form]").hide();
    });

    $(document).on("click", '.user_send', function() {
      var message, user_id, user_replay_form, _this;
      user_replay_form = $(this).closest("[name=user_replay_form]");
      message = user_replay_form.find("[name=user_replay_text]").val();
      if (!message || message.trim().length === 0) {
        alert("Cannot send empty message");
        return;
      }
      user_id = user_replay_form.find("[name=user_id]").val();
      _this = this;
      return $.ajax({
        type: "POST",
        url: "/home/user/" + user_id + "/replay",
        data: {
          message: message
        },
        success: function() {
          alert("Your message sent");
          $(_this).parent().parent().find(".user_replay").show();
          return $(_this).closest("[name=user_replay_form]").hide();
        },
        dataType: "JSON"
        });
      });
    });


