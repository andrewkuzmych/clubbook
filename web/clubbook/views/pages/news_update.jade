extends ../layout

block content
  h3.page-title
    | News
  .page-bar
    ul.page-breadcrumb
      li
        i.fa.fa-home
        a(href='/venue/news_create') News
  .row
    .col-md-12
      div.portlet-body.form
        form#form_update_news.form-horizontal(method="post", role="form")
          .form-actions.top.right
            .row
              .col-md-offset-3.col-md-9
                button.btn.green(type='submit') Submit
                a.btn.default(href="/venue/club_news/#{club_id}", style="margin-left:5px;") Cancel
          .form-body
              .alert.alert-danger.display-hide
                button.close(data-close='alert')
                | You have some form errors. Please check below.
              .alert.alert-success.display-hide
                button.close(data-close='alert')
                | Your form validation is successful!
              
              if has_error
                div.alert.alert-danger.display-hide(style="display: block;")
                  button.close(data-close="alert")
                  | Incorrect data!!!
              .form-group
                  label.col-md-3.control-label Cover Image
                  .col-md-4
                    //.preview
                      if news.image
                        img(border='0', src='#{news.image}', height='200')
                   
                    table.table
                      if news.photos
                        for photo in news.photos
                            tr
                              td(style="vertical-align: middle;")
                                img.news_image(border='0', src='#{photo}', height='200')
                              td(style="vertical-align: middle;")
                                a.btn.red.delete delete
                     
                    div.fileUpload.btn.btn-default
                      span Upload
                      !=cloudinary.uploader.image_upload_tag('image', {html: { class: "upload", tag:"upload_images" }})
                    div#upload_images_progress
                      div.bar(style="width:0%;height:18px;background: green;")

                    input(type="hidden", name="news_images", value="#{news.photos?news.photos.join():''}")
              .form-group
                label.control-label.col-md-3 Name
                  span.required *
                .col-md-4
                  .input-icon.right
                    i.fa
                    input.form-control(type='text', placeholder='Enter news title', name="title", value="#{news.title?news.title:''}")

              .form-group.last
                label.col-md-3.control-label Description
                  span.required *
                .col-md-4
                  .input-icon.right
                    i.fa
                    textarea.form-control(rows="5", placeholder="Enter news description", name="description") #{news.description?news.description:''}
              .form-group
                label.control-label.col-md-3 Share
                .col-md-4
                  .input-icon.right
                    i.fa
                    input.form-control(type='text', placeholder='Enter URL', class="aaa", name="share", value="#{news.share?news.share:''}")
              .form-group
                label.control-label.col-md-3 Buy tickets
                .col-md-4
                  .input-icon.right
                    i.fa
                    input.form-control(type='text', placeholder='Enter URL', name="buy_tickets", value="#{news.buy_tickets?news.buy_tickets:''}")
              .form-group
                .col-md-3 
                .col-md-4
                  if type_news == "event"
                    input.form-control(type='checkbox' class="check" name='event_check' checked)
                  else
                    input.form-control(type='checkbox' class="check" name='event_check')
                  label.control-label Event
              .form-group.events
                .form-group
                  label.control-label.col-md-3 Start
                  .col-md-3
                    .input-group
                      .input-group.date.date-picker(data-date-format='dd-mm-yyyy')
                        input.form-control(type='text', name="start_date", value="#{start_date_?start_date_:data_time}" readonly)
                        span.input-group-btn
                          button.btn.default.date-set(type='button')
                            i.fa.fa-calendar
                  .col-md-3
                    .input-group
                      input.form-control.timepicker.timepicker-no-seconds(type='text', class='st_tm' name='start_time', data-default-time="", value="#{start_time_?start_time_:'22:00'}" readonly)
                      span.input-group-btn
                        button.btn.default(type='button')
                            i.fa.fa-clock-o
                .form-group
                  label.control-label.col-md-3 End
                  .col-md-3
                    .input-group
                      .input-group.date.date-picker(data-date-format='dd-mm-yyyy')
                        input.form-control(type='text', name="end_date", value="#{end_date_?end_date_:data_time}")
                        span.input-group-btn
                          button.btn.default.date-set(type='button')
                            i.fa.fa-calendar
                  .col-md-3
                    .input-group
                      input.form-control.timepicker.timepicker-no-seconds(type='text', name='end_time', data-default-time="", value="#{end_time_?end_time_:'22:00'}")
                      span.input-group-btn
                        button.btn.default(type='button')
                            i.fa.fa-clock-o
            .form-actions.right
              .row
                .col-md-offset-3.col-md-9
                  button.btn.green(type='submit') Submit
                  a.btn.default(href="/venue/club_news/#{club_id}", style="margin-left:5px;") Cancel

block scripts
  script(src="/assets/admin/pages/scripts/update_news.js", type='text/javascript')
  script(src='/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js', type='text/javascript')
  script(type="text/javascript")
    // Configure Cloudinary
    $.cloudinary.config({ api_key: '!{api_key}', cloud_name: '!{cloud_name}' });
    //$.(".events").hide()
    $('[tag=upload_images].cloudinary-fileupload').bind('fileuploadstart', function(e){
      //$('.preview').html('Upload started...');
      $('#upload_images_progress .bar').css('width', '0%');
    });
    $('.check').click(function () {
      $(".events").toggle(this.checked);
    });

    $('[tag=upload_images].cloudinary-fileupload').bind('fileuploadprogress', function(e, data) { 
      $('#upload_images_progress .bar').css('width', Math.round((data.loaded * 100.0) / data.total) + '%'); 
    });
    // Upload finished
    $('[tag=upload_images].cloudinary-fileupload').bind('cloudinarydone', function(e, data){
      $( "table.table" ).prepend( "<tr><td style='vertical-align: middle;'><img class='news_image' src='" + $.cloudinary.url(data.result.public_id) + "' height='200'></td><td style='vertical-align: middle;'><a class='btn red delete'>delete</a></td></tr>");
      $('#upload_images_progress .bar').css('width', '0%');
      updateClubImages()
      return true;
    });

    $(".delete").live("click", function(){
      $(this).closest('tr').remove();  
      updateClubImages();
    });

    function updateClubImages() {
      $('[name=news_images]').val($('img.news_image').map(function() { return this.src; }).get().join());
    }
    $(function () {
      if("#{type_news}" == "news"){
        $(".events").css("display", "none");
      }
      else{ 
        $(".events").css("display", "block");
        }
      console.log("payment");
      $('.date-picker').datepicker({
        autoclose: true
      });
    });

    FormValidation.init();
    ComponentsPickers.init();

